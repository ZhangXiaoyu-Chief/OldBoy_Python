#################################################
# Created on: 2016年2月13日
# @author: 张晓宇
# Email: 61411916@qq.com
# Blog: http://www.cnblogs.com/zhangxiaxuan/
# GitHub: https://github.com/ZhangXiaoyu-Chief
#################################################


作业一：ATM + 购物商城程序
    1、额度 15000或自定义
    2、实现购物商城，买东西加入 购物车，调用信用卡接口结账
    3、可以提现，手续费5%
    4、每月22号出账单，每月10号为还款日，过期未还，按欠款总额 万分之5 每日计息
    5、支持多账户登录
    6、支持账户间转账
    7、记录每月日常消费流水
    8、提供还款接口
    9、ATM记录操作日志
    10、提供管理接口，包括添加账户、用户额度，冻结账户等。。。

程序结构：
.
├── 65shopping.py             #=> 商城主程序
├── atm_admin.py              #=> ATM后台程序
├── atm_daily.py              #=> ATM每日定时任务程序
├── atm_main.py               #=> ATM主程序
├── conf.py                   #=> 配置文件
├── dbs                       #=> 数据目录
│   ├── account.db            #=> ATM账户数据
│   ├── customer.db           #=> 商城用户数据
│   ├── goods.db              #=> 商城商品数据
│   └── __init__.py
├── libs                      #=> 库目录
│   ├── __init__.py
│   └── mylib.py              #=> 自定义库文件
├── log                       #=> 日志目录
│   ├── atm.log               #=> ATM日志
│   └── shopping.log          #=> 商城目录
├── model                     #=> 模块目录
│   ├── account.py
│   ├── atm.py
│   ├── customer.py
│   ├── goods.py
│   ├── __init__.py
│   └── shopping.py
└── readme.txt


程序配置：
    配置文件conf.py
    # 全局
    MAX_PER_PAGE = 5    #=> 分页，表示每一页最多显示多少项

    # 银行相关
    ATM_LOG = 'log/atm.log'     #=> ATM日志文件
    ACCOUNT_FILE = 'dbs/account.db'      #=> 账户数据文件
    MAX_BALANCE = 15000.0       #=> 默认可用额度
    DEFAULT_PASSWORD = '123.com'     #=> 默认账户密码
    MAX_ERROR_COUNT = 3     #=> 银行密码输入错误计数器阀值，达到这个值将会被锁定
    ADMIN_USER = 'admin'     #=> 银行后台密码
    ADMIN_PASSWORD = 'cbff36039c3d0212b3e34c23dcde1456'    #=> 银行后台密码

    # 银行每日任务相关
    BILL_DAY = 22     #=> 账单日
    REPAYMENT_DAY = 10     #=> 还款日


    # 商城相关
    CUSTOMER_FILE = 'dbs/customer.db'    #=> 用户数据文件
    GOODS_FILE = 'dbs/goods.db'    #=> 商品数据文件
    SHOPPING_LOG = 'log/shopping.log'    #=> 商城日志文件


运行环境：Python3.0或以上版本并配置好环境变量（linux主机为了和自带的python2.x版本不冲突，需将python3.X的可执行文件重名为python3或创建名为python3的软链接链接到python的可知文件）

执行方法：
    1、Linux：直接执行# python3 myEval.py或#./myEval.py（需要给主程序文件添加可执行权限）
    2、Window：无，本程序不能再Windows上执行

使用方法：
    一、ATM前台
        1、登录：输入用户名卡号，用户输入卡号密码进行验证，如果1天内密码输入错误达到3次账户将会被锁定
            卡号（输入quit退出认证）: 123456780
            密码:
            认证成功，按任意键继续

        2、主界面：认证成功进入到主界面，主界面显示账户户名及当前余额，在主界面输入相应的菜单编号进入相应的界面
            **********************************
            * 欢迎来到65银行                 *
            * Version: 1.0                   *
            * 张晓宇 您好                    *
            * 当前余额: 8451.0               *
            **********************************
            1、 查看详细信息
            2、 查看账单
            3、 提现
            4、 还款
            5、 同行转账
            6、 查看消费流水
            7、 修改密码
            8、 退出
        3、查看详细信息：在主界面输入1进入查看详细信息界面，会显示账户的详细信息，按任意键退回至主界面
            请选择：1

            用户详细信息
            -----------------------------------------------------
                 卡号: 123456780
                 户名: 张晓宇
                 地址: 北京市通州区
                 电话: 13800138000
                 邮箱: a@b.com
             可用余额: 8451.0
             提现余额: 7500.0
             可用额度: 15000.0
                 状态: 正常
            -----------------------------------------------------

            按任意键继续
        4、查看账单：在主界面输入2，可以查看当前账单
            请选择：2

            --------------------------------本期账单------------------------------------
             账单日: 2016-02-22 还款日: 2016-03-10
            ----------------------------------------------------------------------------
             应还款金额  =  上期账单金额  -  上期还款金额  +  本期账单金额  +  利息
             6549.0         0                0                6549.0           0      
            ----------------------------------------------------------------------------
            按任意键继续
        5、提现：主界面输入3进入提现界面，然后输入提现金额，金额只能是100的整数倍，输入r返回主菜单
            请选择：3
            输入提示：
              取现金额必须是100的整数倍
              金额不能大于余额
              输入r返回主菜单
            请输入提现金额: 100
            提现成功，按任意键继续
        6、还款：主界面输入4进入还款界面，然后输入还款金额，输入r返回主菜单
            请选择：4
            操作提示：输入r返回主菜单
            请输入还款金额: 200
            还款成功，按任意键继续
        7、转账：主界面输入5进入转账界面，然后输入对方卡号，输入金额，输入r返回主界面
            请选择：5
            输入提示: 卡号是9位数字，输入r返回上级菜单
            请输入对方卡号: 123456789
            输入提示：
              金额不能大于余额
            请输入转账金额: 100
            转账成功，按任意键继续
        8、查看消费流水：主界面输入6进入查看消费流水，该界面输入n进入下一页，输入b进入上一页，输入r返回主界面
            请选择：6
                                        消费流水                            
            -----------------------------------------------------------------
             序号   时间                      项目                 金额                
                1   2016-02-12 21:12:39       65商城购物           6399.0              
                2   2016-02-12 21:15:00       65商城购物           150.0              
                3   2016-02-13 21:21:05       提现                 100.0              
                4   2016-02-13 21:22:54       提现                 100.0              
                5   2016-02-13 21:25:22       还款                 200.0              
            -----------------------------------------------------------------
                                                              当前第1页/共2页
            操作提示：
             输入n进入下一页，输入b进入上一页，输入r返回上一级菜单
             请输入:
        9、修改密码：主界面输入7进入修改密码界面，然后输入旧密码、新密码及确认密码完成密码修改，修改成功返回主界面，输入原密码时输入r返回主界面
            请选择：7
            原密码(输入r返回上级菜单):
            新密码:
            确认密码:
            密码修改成功，按任意键返回上级菜单
        10、退出：主界面输入8退出程序
            请选择：8
            谢谢您的使用，再见！按任意键结束

    二、ATM后台
        1、登录：输入后台用户名密码进入ATM后台
            用户名（输入quit退出）：admin
            密码:
            认证成功，按任意键继续
        2、主界面；认证成功后进入主界面，在主界面输入相应菜单编号进入相应模块
            **********************************
            * 欢迎来到65银行后台系统         *
            * Version: 1.0                   *
            * admin 您好                     *
            **********************************
            1、 添加账户
            2、 查看并管理账户
            3、 退出系统
        3、添加账户：主界面输入1进入添加账户界面，输入相应信息完成添加，在输入过程中任意一个环节输入r返回主菜单
            请选择：1
            输入提示: 卡号必须是9位数字，并且不能重复，输入r返回上级菜单
            卡号: 123456788
            输入提示: 账户名不能为空，长度不能超过10个字符，输入r返回上级菜单
            账户名: 擎天柱    
            输入提示: 联系电话为手机号，长度为11位，输入r返回上级菜单
            联系电话: 13811111111  
            输入提示: 邮箱不能为空，输入r返回上级菜单
            邮箱: qingtianzhu@126.com
            输入提示: 住址不能为空，输入r返回上级菜单
            住址: 赛博坦
            创建用户成功，按任意键继续
        4、查看并管理账户：主界面输入2进入查看并管理账户界面，在此界面输入n进入下一页，输入b进入上一页，，输入序号选定账户，可以进行相应操作。输入r返回主菜单
            请选择：2
                                        查看用户                            
            -----------------------------------------------------------------
             序号   卡号        账户名       电话          状态   可用额度
                1   123456780   张晓宇       13800138000   正常   15000.0
                2   123456781   随便         13000130000   正常   15000.0
                3   123456789   65年哥       13800138000   正常   15000.0
                4   123456788   擎天柱       13811111111   正常   15000.0
            -----------------------------------------------------------------
                                                              当前第1页/共1页

            操作提示：
             输入相应序号选择用户
             输入n进入下一页，输入b进入上一页，输入r返回主菜单
             请输入: 4

            用户详细信息
            -----------------------------------------------------
                 卡号: 123456788
                 户名: 擎天柱
                 地址: 赛博坦
                 电话: 13811111111
                 邮箱: qingtianzhu@126.com
             可用余额: 15000.0
             提现余额: 7500.0
             可用额度: 15000.0
                 状态: 正常
            -----------------------------------------------------

            1、 冻结账户
            2、 解冻账户
            3、 调整账户额度
            4、 锁定账户
            5、 解锁账户
            6、 注销账户
            7、 返回
            在此界面可进行如下操作：
            1）冻结账户：选定账户后输入1冻结该账户
                请选择：1
                修改成功，卡号为123456788的用户已经被冻结，按任意键继续
            2）解冻账户：选定账户后输入2解冻该账户
                请选择：2
                修改成功，卡号为123456788的用户已经解冻，按任意键继续
            3）调整账户额度：选定账户后输入3，然后输入额度，完成调整，调整后的额度将会在下一个账单周期生效
                请选择：3
                请输入新的用户额度: 30000
                修改成功，卡号为123456788的用户额度已经调整为30000.0，按任意键继续
            4）锁定账户：选定账户后输入4锁定账户
                请选择：4
                修改成功，卡号为123456788的用户已经锁定，按任意键继续
            5）解锁账户：选定账户后输入5解锁账户（包括主动锁定和用户输入错误达到阀值锁定的情况）
                请选择：5
                修改成功，卡号为123456788的用户已经解锁，按任意键继续
            6）注销账户：选定账户后输入6，然后输入y确认注销，该账户将被注销，如果输入n取消注销操作
                请选择：6
                请确认是否注销卡号为123456788的用户(y/n): y
                删除成功，卡号为123456788的用户已经删除，按任意键返回账户列表
            7）返回账户列表：选定账户后输入7返回账户列表
        5、退出：主界面输入3退出
            请选择：3
            谢谢您的使用，再见！按任意键结束
    三、ATM每日定时任务
        使用linux定时任务配置每天凌晨0点定时执行ATM每日定时任务程序
        配置方法如下：
        # crontab -e
        /path/to/python3 /path/to/atm_daily.py
    四、65商城
        本次作业的65商城是全新的2.0版本，较之前的1.0版本新增了如下功能：
            1）游客可以直接的登录65商城
            2）开放了注册，用户可以自由注册成为商城的会员
            3）用户的购物车持久化保存，本次放入购物车的商品，下次登录后依然存在
            4）开放了修改密码，用户可以自由的修改自己的密码
            5）用户不再需要提前充值到商城会员账号内，而是通过银行支付接口进行支付
        1、主界面：直接运行程序进入65商城主界面
            **********************************
            * 欢迎来到65商城                 *
            * Version: 2.0                   *
            * 游客 您好                      *
            **********************************
            1、 血拼
            2、 注册
            3、 登录
            4、 注销
            5、 修改密码
            6、 查看购物车
            7、 退出
        2、购物：主界面输入1会显示商品列表，在此界面输入n进入下一页，输入b进入上一页，，输入序号选定商品查看商品详细信息并可进行相应操作。输入r返回主菜单
            请选择：1
            商品列表
            --------------------------------------------------------------------------------
             序号   编号    商品名                                        价格       分类    
                1   0001    苹果6S 16G 玫瑰金色 移动联通电信4G手机        5000.0     手机通讯
                2   0002    小米4 16G 全网通手机                          1299.0     手机通讯
                3   0003    <<Python指南>>                                50.0       图书音像
                4   0004    <<我的Python成长之路>>                        150.0      图书音像
                5   0005    <<JAVA自学手册>>                              1500.0     图书音像
            --------------------------------------------------------------------------------
                                                                             当前第1页/共2页

            操作提示：
             输入相应序号选择商品
             输入n进入下一页，输入b进入上一页，输入r返回上一级菜单
             请输入: 4
             -----------------------------------------------------
                     编号: 0004
                 商品名称: <<我的Python成长之路>>
                     价格: 150.0
                     分类: 图书音像
             商品详细信息:
            -----------------------------------------------------
                65年哥的大作，收您老150一点也不贵
            -----------------------------------------------------

            1、 加入购物车
            2、 返回
            请选择：
            在此界面可进行如下操作：
            1）加入购物车
                请选择：1
                成功将<<我的Python成长之路>>加入购物车，按任意键继续
            2）返回商品列表：输入2返回商品列表
        3、注册：未登录状态下主界面输入2进入注册界面，输入用户名、密码等详细信息即可注册，在输入过程中任意一个环节输入r返回主菜单
            请选择：2
            输入提示: 用户名必须是数字和字母的组合，长度不超过15个字符，输入r返回上级菜单
            用户名:zhang  
            输入提示: 密码长度介于6~15个字符，输入r返回上级菜单
            密码:
            输入提示: 确认密码必须与密码一致，输入r返回上级菜单
            确认密码:
            输入提示: 姓名不能为空，长度不能超过10个字符，输入r返回上级菜单
            姓名: 测试账户
            输入提示: 联系电话为手机号，长度为11位，输入r返回上级菜单
            联系电话: 13000000000
            输入提示: 邮箱不能为空，输入r返回上级菜单
            邮箱: a@b.com
            输入提示: 住址不能为空，输入r返回上级菜单
            住址: 北京市海淀区
            创建用户成功，按任意键继续
        4、登录：未登录状态下主界面输入3进入登录界面，输入用户名、密码进行认证，成功登录后如果游客状态下有商品加入到购物车，将会与用户的购物车进行合并
            请选择：3
            用户名(输入r返回主菜单): zhangxiaoyu
            密码:
            登录成功，按任意键返回主菜单
        5、注销：登录状态下主界面输入4退出登录
            请选择：4
            注销成功，按任意键继续
        6、修改密码：登录状态下，主界面输入5，进入密码修改界面，输入旧密码、新密码、确认密码完成密码修改，任何步骤输入r返回主界面
            请选择：5
            输入提示: 输入r返回上级菜单
            原密码:
            输入提示: 密码长度介于6~15个字符，输入r返回上级菜单
            密码:
            输入提示: 密码长度介于6~15个字符，输入r返回上级菜单
            确认密码:
            密码修改成功，按任意键返回上级菜单
        7、查看购车：主界面下输入6进入到购物车界面，可以进行购物车相应操作
            请选择：6
            序号     商品编号    商品名称                                              单价        个数    小计
            ----------------------------------------------------------------------------------------------------
               1       0003      <<Python指南>>                                        50.0           1     50.0
               2       0004      <<我的Python成长之路>>                               150.0           1    150.0
            ----------------------------------------------------------------------------------------------------
                                                                                                 总计：200.0
            操作： 结账(p)    返回上级菜单(r)    清空购物车(e)    删除商品(d)
            1）删除商品：购物车界面输入d，然后输入购物车内商品对应的序号，并进行确认操作即可删除一件该商品，输入r返回购物车界面
                请选择您的操作：d
                请输入编号(输入r返回): 2  
                请确认删除1个<<我的Python成长之路>>(y/n): y
                成功删除1个<<我的Python成长之路>>
            2）清空购物车：购物车界面输入e，并进行确认操作即可清空购物车
                请选择您的操作：e  
                请确认是否清空购物车(y/n): y
                购物车已经清空，按任意键继续
            3）结账：登录状态下，购物车界面输入p进入进入支付界面，输入卡号、密码，即可完成支付，支付成功后购物车将被清空，并返回主界面
                请选择您的操作：p
                卡号（输入quit退出认证）: 123456780
                密码:
                认证成功，按任意键继续
                支付成功，按任意键返回上级菜单
        8、退出：主界面下输入7退出系统
            请选择：7